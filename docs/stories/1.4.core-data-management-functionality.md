# <!-- Powered by BMAD™ Core -->

# Story 1.4: Core Data Management Functionality

## Status
Draft

## Story
**As a** user,  
**I want** to be able to add new customers and new jobs, and update the status of existing jobs,  
**so that** I can perform the primary functions of the CRM.

## Acceptance Criteria
1. การกดปุ่ม "เพิ่มลูกค้าใหม่" จะแสดงฟอร์มสำหรับกรอกข้อมูล และสามารถเพิ่มลูกค้าลงในข้อมูลจำลองได้
2. การกดปุ่ม "สร้างงานใหม่" จะแสดงฟอร์มสำหรับกรอกข้อมูล และสามารถสร้างงานใหม่ลงในข้อมูลจำลองได้
3. ผู้ใช้สามารถคลิกที่งานในรายการเพื่อดูรายละเอียดและสามารถ "เปลี่ยนสถานะ" ของงานนั้นได้

## Tasks / Subtasks
- [ ] Task 1: Create Add Customer Form component (AC: 1)
  - [ ] Create `AddCustomerForm` component in apps/web/src/components/
  - [ ] Design form with fields: name (required), email, phone
  - [ ] Use shadcn/ui Form, Input, and Button components
  - [ ] Implement client-side validation (name required)
  - [ ] Handle form submission to dummy data service
- [ ] Task 2: Create Add Job Form component (AC: 2)
  - [ ] Create `AddJobForm` component in apps/web/src/components/
  - [ ] Design form with fields: description (required), customer selection, status dropdown
  - [ ] Use shadcn/ui Form, Input, Select, Textarea components
  - [ ] Implement customer dropdown from existing customer data
  - [ ] Handle form submission to dummy data service
- [ ] Task 3: Create Job Detail Page component (AC: 3)
  - [ ] Create `JobDetailPage` component in apps/web/src/pages/
  - [ ] Display job information with customer details
  - [ ] Add status update functionality with Select component
  - [ ] Create route /jobs/:id for job detail view
- [ ] Task 4: Implement modal/dialog system (AC: 1, 2)
  - [ ] Create modal system using shadcn/ui Dialog component
  - [ ] Connect "เพิ่มลูกค้าใหม่" button to open AddCustomerForm modal
  - [ ] Connect "สร้างงานใหม่" button to open AddJobForm modal
  - [ ] Handle modal open/close states properly
- [ ] Task 5: Update dummy data service with CRUD operations (All ACs)
  - [ ] Extend dummyData service with add customer function
  - [ ] Extend dummyData service with add job function
  - [ ] Implement update job status function
  - [ ] Add UUID generation for new records
  - [ ] Ensure data persistence during session (React Context/local state)
- [ ] Task 6: Update existing pages to use new functionality (All ACs)
  - [ ] Update CustomerListPage to show newly added customers
  - [ ] Update JobListPage to show newly added jobs and link to job details
  - [ ] Make job table rows clickable to navigate to job detail
  - [ ] Refresh data after add/update operations
- [ ] Task 7: Testing and validation (All ACs)
  - [ ] Create unit tests for form components
  - [ ] Test form validation and submission
  - [ ] Test CRUD operations in dummy data service
  - [ ] Test navigation and modal interactions

## Dev Notes

### Previous Story Insights
Story 1.3 (Customer & Job Management Pages) provides the list pages with buttons. This story makes those buttons functional by adding forms and data management capabilities.

### Data Models and Validation Requirements
[Source: architecture/data-models.md]

```ts
// Customer validation requirements
export interface Customer {
  id: string;          // Auto-generated UUID
  created_at: string;  // Auto-generated timestamp
  name: string;        // Required field
  email: string;       // Optional, validate email format if provided
  phone: string;       // Optional
}

// Job validation requirements
export interface Job {
  id: string;              // Auto-generated UUID
  created_at: string;      // Auto-generated timestamp
  customer_id: string;     // Required, must exist in customer data
  description: string;     // Required field
  status: 'New' | 'In Progress' | 'Done';  // Default to 'New'
  customers?: Customer;    // Join data for display
}
```

### Tech Stack Requirements
[Source: architecture/tech-stack.md]
- **Frontend Language**: TypeScript ~5.x
- **Frontend Framework**: React ~18.x
- **UI Component Library**: shadcn/ui - Form, Input, Select, Button, Dialog, Textarea components
- **CSS Framework**: Tailwind CSS ~3.x
- **State Management**: React Context API for dummy data persistence
- **Validation**: Client-side validation with React Hook Form (compatible with shadcn/ui)

### Project Structure Requirements
[Source: architecture/unified-project-structure.md]
**Component Locations**:
- Form components: `/apps/web/src/components/`
- Page components: `/apps/web/src/pages/`
- Services: `/apps/web/src/services/`
- Types: `/packages/shared/types.ts`

### Form Design Requirements
[Source: prd/user-interface-design-goals.md]
- **Design Philosophy**: "Effortless" - simple, clear forms that prevent errors
- **Form Layout**: Clean, well-spaced form fields with proper labels
- **Validation**: Clear validation messages, prevent submission if required fields missing
- **Error Handling**: User-friendly error messages in Thai language
- **Success Feedback**: Clear confirmation when operations succeed

### Modal and Navigation Patterns
- Use shadcn/ui Dialog component for modal forms
- Forms should close modal on successful submission
- Job list items should be clickable rows that navigate to detail page
- Job detail page should have URL parameter for job ID
- Back navigation from job detail to job list

### Data Management Strategy
[Source: prd/requirements.md#NFR5]
- Continue using dummy data approach for MVP
- Use React Context or state management for session persistence
- Generate UUIDs for new records (use crypto.randomUUID() or uuid library)
- Maintain referential integrity (jobs reference valid customers)
- Data should survive navigation but reset on page refresh (acceptable for MVP)

### Environment Configuration Standards
[Source: architecture/coding-standards.md]
- **Type Sharing**: Import interfaces from `packages/shared/types.ts`
- **Data Access**: Prepare structure for future Supabase integration
- **Form Handling**: Use consistent patterns that can be easily migrated to API calls

### Testing Requirements
[Source: architecture/tech-stack.md]
- **Testing Framework**: Vitest + React Testing Library
- **Form Testing**: Test form validation, submission, and error handling
- **Modal Testing**: Test dialog open/close behavior
- **Navigation Testing**: Test job detail page routing
- **Data Service Testing**: Test CRUD operations in dummy service

### Accessibility Requirements
[Source: prd/user-interface-design-goals.md#accessibility]
- **Forms**: Proper labels, fieldsets, and validation messages
- **Modals**: Focus management, escape key handling, screen reader support
- **Clickable Rows**: Keyboard navigation support for job list items
- **Status Updates**: Clear feedback for status changes

### File Locations
Based on project structure, create files at:
- Customer form: `/apps/web/src/components/AddCustomerForm.tsx`
- Job form: `/apps/web/src/components/AddJobForm.tsx`
- Job detail: `/apps/web/src/pages/JobDetailPage.tsx`
- Extended service: `/apps/web/src/services/dummyData.ts` (update existing)
- Component tests: Adjacent `.test.tsx` files

## Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 30/08/2025 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be populated by dev agent*

### Debug Log References  
*To be populated by dev agent*

### Completion Notes List
*To be populated by dev agent*

### File List
*To be populated by dev agent*

## QA Results
*Results from QA Agent review will be populated here*